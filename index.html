<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini Akinator — Biraj Bhattarai</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#10b981;--muted:#94a3b8}
    body{margin:0;background:linear-gradient(180deg,#071022,#081426);color:#e6eef8;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px}
    .app{width:960px;max-width:96vw;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;padding:20px;display:grid;grid-template-columns:1fr 360px;gap:18px;box-shadow:0 10px 30px rgba(2,6,23,0.7)}
    header{grid-column:1/-1;display:flex;gap:12px;align-items:center}
    header h1{margin:0;font-size:18px}
    .left{padding:18px;background:var(--card);border-radius:10px}
    .right{padding:18px;background:rgba(255,255,255,0.02);border-radius:10px}
    .question{font-size:20px;margin-bottom:10px}
    .btn-row{display:flex;gap:10px}
    .primary{background:var(--accent);color:#042024;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px 14px;border-radius:8px;color:#cfe7dd;cursor:pointer}
    .guess-card{padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)}
    .small{font-size:13px;color:var(--muted)}
    @media (max-width:880px){ .app{grid-template-columns:1fr} .right{order:2} }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Mini Akinator">
    <header>
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36' viewBox='0 0 24 24'><circle cx='12' cy='12' r='10' fill='%2310b981'/><path fill='%2308140b' d='M7 12c0-2.8 2.2-5 5-5s5 2.2 5 5-2.2 5-5 5-5-2.2-5-5z'/></svg>" alt="" style="width:44px;height:44px;border-radius:8px;">
      <div>
        <h1>Mini Akinator</h1>
        <div class="small">Works offline. Biraj Bhattarai is included as a musical artist.</div>
      </div>
    </header>

    <section class="left">
      <div class="question" id="questionText">Ready? Think of a character and I'll start.</div>
      <div class="small">Questions asked: <span id="askedCount">0</span> · Candidates left: <span id="cLeft">0</span></div>
      <div style="height:12px;background:rgba(255,255,255,0.03);border-radius:999px;margin:10px 0"><i id="progress" style="display:block;height:100%;width:0;background:linear-gradient(90deg,#10b981,#34d399);border-radius:999px"></i></div>
      <div class="btn-row" style="margin-bottom:10px">
        <button class="primary" id="yesBtn">Yes</button>
        <button class="ghost" id="noBtn">No</button>
        <button class="ghost" id="idkBtn">I don't know</button>
        <button class="ghost" id="resetBtn" style="margin-left:auto">Reset</button>
      </div>

      <div id="candidatesList" class="small" style="margin-bottom:10px">Candidates: —</div>

      <div id="guessCard" class="guess-card" hidden>
        <div style="font-weight:700" id="guessTitle">Is it ...?</div>
        <div class="small" id="guessDesc">Confidence: —</div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button class="primary" id="confirmGuess">Yes — correct</button>
          <button class="ghost" id="wrongGuess">No — add</button>
        </div>
      </div>

      <div id="finishCard" class="guess-card" style="margin-top:10px" hidden>
        <div style="font-weight:700">Add Character</div>
        <form id="addForm" style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
          <input id="newName" placeholder="Name" required />
          <textarea id="newDesc" rows="2" placeholder="Short description"></textarea>
          <div id="traitsGrid" style="display:grid;grid-template-columns:repeat(2,1fr);gap:6px"></div>
          <div style="display:flex;gap:8px">
            <button class="primary" type="submit">Add</button>
            <button class="ghost" type="button" id="cancelAdd">Cancel</button>
          </div>
          <div id="addResult" class="small" style="display:none"></div>
        </form>
      </div>
    </section>

    <aside class="right">
      <div style="font-weight:700">Game stats</div>
      <div class="small" style="margin-top:6px">Asked: <span id="statAsked">0</span></div>
      <div class="small">Candidates: <span id="statCand">0</span></div>
      <div class="small">Traits: <span id="statTraits">0</span></div>

      <hr style="opacity:.06;margin:14px 0">

      <div style="font-weight:700">DB sample</div>
      <div id="dbPreview" class="small" style="margin-top:8px;max-height:260px;overflow:auto"></div>
    </aside>
  </div>

<script>
/* CONFIG */
window.API_BASE = null; // frontend-only

const TRAITS = {
  real: "Is real / Non-fictional",
  male: "Is male",
  female: "Is female",
  fromNepal: "From Nepal",
  singer: "Is a singer",
  actor: "Is an actor",
  athlete: "Is an athlete",
  fictional: "Is fictional",
  anime: "From anime/manga",
  activist: "Is an activist",
};

/* Local sample DB with Biraj included */
let characters = [
  { name: "Rajesh Hamal", desc:"Nepali film actor", traits:{ real:true, male:true, fromNepal:true, actor:true }},
  { name: "Rekha Thapa", desc:"Nepali actress and producer", traits:{ real:true, female:true, fromNepal:true, actor:true }},
  { name: "Biraj Bhattarai", desc:"Nepali musical artist", traits:{ real:true, male:true, fromNepal:true, singer:true }},
  { name: "Anuradha Koirala", desc:"Nepali activist (Maiti Nepal)", traits:{ real:true, female:true, fromNepal:true, activist:true }},
  { name: "Narayan Gopal", desc:"Legendary Nepali singer (deceased)", traits:{ real:true, male:true, fromNepal:true, singer:true }},
  { name: "Nabin K Bhattarai", desc:"Nepali pop singer", traits:{ real:true, male:true, fromNepal:true, singer:true }},
  { name: "Lionel Messi", desc:"Footballer", traits:{ real:true, male:true, athlete:true }},
  { name: "Pikachu", desc:"Pokemon creature", traits:{ real:false, fictional:true, anime:true }},
  { name: "Sherlock Holmes", desc:"Fictional detective", traits:{ real:false, fictional:true }},
  { name: "Naruto Uzumaki", desc:"Anime character", traits:{ real:false, fictional:true, anime:true }}
];

/* GAME STATE */
let askedQuestions = [], questionCount=0, candidates=[], history=[];
const MAX_QUESTIONS = 12;

/* DOM */
const qText = document.getElementById('questionText');
const askedCount = document.getElementById('askedCount');
const cLeft = document.getElementById('cLeft');
const yesBtn = document.getElementById('yesBtn');
const noBtn = document.getElementById('noBtn');
const idkBtn = document.getElementById('idkBtn');
const resetBtn = document.getElementById('resetBtn');
const progress = document.getElementById('progress');
const candidatesList = document.getElementById('candidatesList');
const guessCard = document.getElementById('guessCard');
const guessTitle = document.getElementById('guessTitle');
const guessDesc = document.getElementById('guessDesc');
const confirmGuess = document.getElementById('confirmGuess');
const wrongGuess = document.getElementById('wrongGuess');
const finishCard = document.getElementById('finishCard');
const addForm = document.getElementById('addForm');
const newNameIn = document.getElementById('newName');
const newDescIn = document.getElementById('newDesc');
const traitsGrid = document.getElementById('traitsGrid');
const cancelAdd = document.getElementById('cancelAdd');
const addResult = document.getElementById('addResult');
const statAsked = document.getElementById('statAsked');
const statCand = document.getElementById('statCand');
const statTraits = document.getElementById('statTraits');
const dbPreview = document.getElementById('dbPreview');

/* HELPERS */
function updateDbPreview(){ dbPreview.innerHTML=''; characters.forEach(c=>{ const d=document.createElement('div'); d.style.padding='6px 0'; d.innerHTML=`<strong>${c.name}</strong> <div style="color:#94a3b8;font-size:13px">${c.desc||''}</div><div style="color:#94a3b8;font-size:13px">traits: ${Object.keys(c.traits||{}).filter(t=>c.traits[t]).join(', ')||'—'}</div>`; dbPreview.appendChild(d); }); statTraits.textContent = Object.keys(TRAITS).length; }

function renderTraitCheckboxes(){ traitsGrid.innerHTML=''; Object.keys(TRAITS).forEach(k=>{ const lbl=document.createElement('label'); lbl.style.display='flex'; lbl.style.gap='8px'; lbl.innerHTML=`<input type="checkbox" value="${k}"> ${TRAITS[k]}`; traitsGrid.appendChild(lbl); }); }

function startGame(){ askedQuestions=[]; questionCount=0; history=[]; guessCard.hidden=true; finishCard.hidden=true; addResult.style.display='none'; newNameIn.value=''; newDescIn.value=''; candidates=characters.map((_,i)=>i); updateUIForNextQuestion("Think of a character — I'll ask questions."); }

function updateUIForNextQuestion(initialText){ askedCount.textContent=questionCount; cLeft.textContent=candidates.length; statAsked.textContent=questionCount; statCand.textContent=candidates.length; updateDbPreview(); if(candidates.length<=1 || questionCount>=MAX_QUESTIONS){ makeGuess(); return; } const remainingTraits = Object.keys(TRAITS).filter(t=>!askedQuestions.includes(t)); let q=null; let bestScore=Infinity; remainingTraits.forEach(tr=>{ let ct=0; candidates.forEach(i=>{if(characters[i].traits && characters[i].traits[tr]) ct++;}); const n=candidates.length; if(ct===0||ct===n) return; const score=Math.abs(n/2-ct); if(score<bestScore){bestScore=score; q=tr;} }); if(!q) q=remainingTraits[0]||Object.keys(TRAITS)[0]; qText.dataset.currentTrait=q; qText.textContent=initialText?initialText:TRAITS[q]; progress.style.width=Math.min(100,Math.round((questionCount/MAX_QUESTIONS)*100))+'%'; candidatesList.textContent="Candidates: "+candidates.map(i=>characters[i].name).slice(0,8).join(', ')+(candidates.length>8?', ...':''); }

function answer(ans){ const t=qText.dataset.currentTrait; askedQuestions.push(t); questionCount++; history.push({q:t,ans}); if(ans==='yes') candidates=candidates.filter(i=>!!characters[i].traits[t]); else if(ans==='no') candidates=candidates.filter(i=>!characters[i].traits[t]); if(candidates.length===0){ qText.textContent="I couldn't find a match — add it!"; finishCard.hidden=false; guessCard.hidden=true; return; } if(candidates.length<=2 || questionCount>=MAX_QUESTIONS){ makeGuess(); return; } updateUIForNextQuestion(); }

function makeGuess(){ if(candidates.length===0){ qText.textContent="No match found. Add the character."; finishCard.hidden=false; guessCard.hidden=true; return; } let bestIdx=candidates[0]; let bestConf=computeConfidence(bestIdx); candidates.forEach(i=>{ const c=computeConfidence(i); if(c>bestConf){bestConf=c;bestIdx=i;} }); const p=characters[bestIdx]; guessCard.hidden=false; finishCard.hidden=true; guessTitle.textContent=`Is it ${p.name}?`; guessDesc.textContent=`${p.desc||''} · Confidence: ${(bestConf*100).toFixed(0)}%`; qText.textContent="I have a guess — is this your character?"; }

function computeConfidence(idx){ if(history.length===0) return 0.5; let matches=0,total=0; history.forEach(h=>{ if(h.ans==='idk') return; total++; const val=!!characters[idx].traits[h.q]; if((h.ans==='yes' && val) || (h.ans==='no' && !val)) matches++; }); return total===0?0.5:Math.max(0.05,Math.min(0.99,matches/total)); }

function confirmCorrect(){ qText.textContent="Yay! I guessed it."; guessCard.hidden=true; }

function handleWrongGuess(){ qText.textContent="Oh no — add the correct character!"; guessCard.hidden=true; finishCard.hidden=false; }

function addCharacterFromForm(e){ e.preventDefault(); const name=newNameIn.value.trim(); const desc=newDescIn.value.trim(); if(!name) return; const boxes=Array.from(traitsGrid.querySelectorAll('input[type="checkbox"]')); const traitsObj={}; Object.keys(TRAITS).forEach(k=>traitsObj[k]=false); boxes.forEach(b=>{if(b.checked) traitsObj[b.value]=true;}); characters.push({name,desc,traits:traitsObj}); addResult.style.display='block'; addResult.textContent=`${name} added locally.`; setTimeout(()=>{ startGame(); addResult.style.display='none'; },900); }

/* EVENTS */
yesBtn.addEventListener('click',()=>answer('yes'));
noBtn.addEventListener('click',()=>answer('no'));
idkBtn.addEventListener('click',()=>answer('idk'));
resetBtn.addEventListener('click',startGame);
confirmGuess.addEventListener('click',confirmCorrect);
wrongGuess.addEventListener('click',handleWrongGuess);
addForm.addEventListener('submit',addCharacterFromForm);
cancelAdd.addEventListener('click',()=>{ finishCard.hidden=true; startGame(); });

/* INIT */
renderTraitCheckboxes();
updateDbPreview();
startGame();

</script>
</body>
</html>
